/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.4/samples
 */
plugins {
    id 'application'
    id 'maven-publish'
}
group = 'in.vadlakonda.equilibrium'
version '1.0'



configurations {
    triImplementation
}

repositories {
    mavenCentral()
}

dependencies {


    //This is compile-time dependency only, the implementation jar will be available on the server
    compileOnly 'in.vadlakonda.equilibrium:tri-husk:1.0'
    compileOnly 'log4j:log4j:1.2.16'
    compileOnly 'javax.servlet:javax.servlet-api:3.1.0'
    compileOnly 'commons-io:commons-io:2.11.0'
    compileOnly 'org.apache.poi:poi:5.2.2'
    compileOnly 'org.apache.poi:poi-ooxml:5.2.2'
//    compileOnly 'it.firegloves:mempoi:version:1.8.0'

    implementation 'com.google.code.gson:gson:2.8.2'
    implementation 'org.apache.commons:commons-lang3:3.12.0'

    triImplementation 'com.google.code.gson:gson:2.8.2'
    triImplementation 'org.apache.commons:commons-lang3:3.12.0'
    triImplementation 'commons-io:commons-io:2.11.0'
    triImplementation 'org.apache.poi:poi:5.2.2'
    triImplementation 'org.apache.poi:poi-ooxml:5.2.2'

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.2'
    testImplementation 'javax.servlet:javax.servlet-api:3.1.0'
    testImplementation 'commons-io:commons-io:2.11.0'
    testImplementation 'org.apache.poi:poi:5.2.2'
    testImplementation 'org.apache.poi:poi-ooxml:5.2.2'
    testImplementation 'log4j:log4j:1.2.16'
    testImplementation "org.mockito:mockito-core:1.+"
    testImplementation 'org.junit.jupiter:junit-jupiter-params:5.7.2'

    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.2'

}


task copyTestResources(type: Copy) {
    from "${projectDir}/src/test/resources"
    into "${buildDir}/classes/test"
}
//processTestResources.dependsOn copyTestResources


test {

    useJUnitPlatform()
}


task singleDependentJar(type: Jar) {
    group = "build"

    duplicatesStrategy = DuplicatesStrategy.INCLUDE

    archiveFileName = "${project.name}-dependencies.jar"

    dependsOn configurations.triImplementation

    from { configurations.triImplementation.collect { it.isDirectory() ? it : zipTree(it) } }

}

task sourceJar(type: Jar) {
    from sourceSets.main.allJava
}


repositories {
    maven {
        name = "GitHubPackages"
        url = uri("https://maven.pkg.github.com/kalyanchakravarthyv/equilibrium-tri-husk")
        credentials {
            username = project.findProperty("gpr.user") ?: System.getenv("GH_USERNAME")
            password = project.findProperty("gpr.key") ?: System.getenv("GH_TOKEN")
        }
    }
}


publishing {
    publications {
        maven(MavenPublication) {
            groupId = 'in.vadlakonda.equilibrium'
            artifactId = 'equilibrium-core'
            version = '1.0'
            from components.java

            artifact sourceJar {
                classifier "sources"
            }
        }
    }
}


task printEnvironmentVariables {

    doFirst {

        println "*** ENVIRONMENT VARIABLE DUMP ***"

        System.getenv().each { k, v -> println "${k}:${v}" }

    }

}

testClasses.dependsOn singleDependentJar